# 業務フロー

## 1. 初期セットアップフロー

```
管理者
  ↓
システム設定の確認・調整
  ↓
プロンプトテンプレートの設定
  ↓
商品情報の登録（URL/PDF/テキスト）
  ↓
ユーザーアカウントの作成
  ↓
運用開始
```

## 2. 商品登録フロー

```
管理者
  ↓
商品基本情報入力
  - 商品名、コード
  - 短い説明、詳細説明
  - 対象業界、企業規模
  - 解決する課題
  ↓
商品ナレッジ登録
  - URLからスクレイピング
  - PDFアップロード
  - テキスト直接入力
  ↓
AIによる自動構造化
  ↓
商品情報完成
```

## 3. 提案資料作成フロー（CSV無し）

```
営業担当者/マネージャー
  ↓
企業URL入力
  ↓
[システム]
  - Webスクレイピング実行
  - AIによる企業情報構造化
  - 推定課題の抽出
  ↓
生成するセクション選択
  □ オープニング
  □ 課題特定
  □ ソリューション提案
  □ 反論処理
  □ クロージング
  ↓
[システム]
  - 商品マッチング実行
  - 最適商品を自動選択（最大3つ）
  ↓
  - トークスクリプト生成
  - 選択されたセクションのみ生成
  ↓
2カラム表示で確認
  左：企業情報・推定課題・推奨商品
  右：トークスクリプト
  ↓
編集・調整（必要に応じて）
  ↓
PowerPoint生成
  ↓
ダウンロード
  ↓
商談実施
```

## 4. 提案資料作成フロー（CSV有り）

```
営業担当者/マネージャー
  ↓
CSVファイルアップロード
  ↓
分析プロンプト入力
  ↓
[システム]
  - pandasでCSV解析
  - AIでデータ分析実行
  ↓
分析結果確認
  ↓
企業URL入力
  ↓
[システム]
  - 企業情報取得・構造化
  ↓
生成するセクション選択
  ↓
[システム]
  - CSV分析結果も考慮して商品マッチング
  - トークスクリプト生成
  - データ分析結果を含むスクリプト
  ↓
2カラム表示で確認
  左：データ分析・企業情報・商品
  右：トークスクリプト
  ↓
編集・調整
  ↓
PowerPoint生成
  ↓
商談実施
```

## 5. トレーニングフロー

```
営業担当者
  ↓
生成されたトークスクリプト表示
  ↓
ロールプレイ練習
  - 各セクションを読み上げ
  - タイミング確認
  - 自然な言い回しに調整
  ↓
気づき・メモを記録
  ↓
自己評価（1-5段階）
  ↓
トレーニング履歴保存
```

## 6. 商談実施後フロー

```
営業担当者
  ↓
商談結果を記録
  - 結果（受注/失注/検討中/無応答）
  - 商談日
  ↓
フィードバック入力
  - うまくいった点
  - 改善が必要な点
  - 顧客の懸念点
  ↓
[システム]
  - AI学習データとして保存
  - 次回のスクリプト生成に活用
  ↓
営業マネージャー
  ↓
成功パターン分析
  - 業界別成功率
  - 商品別成功率
  - よくある懸念の傾向
```

## 7. システム設定変更フロー

```
管理者
  ↓
管理画面にアクセス
  ↓
システム設定画面
  - AI設定（モデル、Temperature）
  - スクレイピング設定
  - ファイルサイズ制限
  - セキュリティ設定
  ↓
プロンプトテンプレート編集
  - 既存テンプレート選択
  - プロンプト内容編集
  - バージョン自動作成
  ↓
保存
  ↓
[システム]
  - 変更履歴記録
  - キャッシュクリア
  ↓
全ユーザーに反映
```

## 8. エラー処理フロー

### スクレイピング失敗
```
企業URL入力
  ↓
[システム] スクレイピング実行
  ↓
エラー発生
  - robots.txt で禁止
  - タイムアウト
  - 接続エラー
  ↓
エラーメッセージ表示
  ↓
ユーザー
  - 別のURLを試す
  - 手動で企業情報入力
```

### AI処理失敗
```
トークスクリプト生成中
  ↓
[システム] OpenAI API呼び出し
  ↓
エラー発生
  - APIキー無効
  - レート制限
  - トークン上限
  ↓
エラーログ記録
  ↓
エラーメッセージ表示
  ↓
管理者
  - API設定確認
  - トークン制限調整
```

## 9. データ管理フロー

### バックアップ
```
[定期実行]
  ↓
PostgreSQLバックアップ
  - 日次フルバックアップ
  - WALアーカイブ
  ↓
メディアファイルバックアップ
  - CSV, PDF, PowerPoint
  ↓
外部ストレージ保存
  ↓
バックアップ検証
```

### データ削除
```
管理者
  ↓
古いデータの特定
  - X日以上前のCSV
  - 使用されていない企業情報
  ↓
削除実行
  ↓
関連データの整合性チェック
  ↓
削除ログ記録
```

## 10. 権限管理フロー

### 営業担当者の権限
- ✅ 自分の案件の閲覧・編集
- ✅ 企業情報の登録
- ✅ CSVアップロード（オプション）
- ✅ トークスクリプト生成
- ✅ 商談結果の記録
- ❌ 他人の案件の閲覧
- ❌ 商品情報の編集
- ❌ システム設定の変更

### 営業マネージャーの権限
- ✅ 全案件の閲覧
- ✅ レポート機能
- ✅ 商品情報の閲覧
- ❌ 商品情報の編集
- ❌ システム設定の変更
- ❌ ユーザー管理

### 管理者の権限
- ✅ 全機能アクセス
- ✅ ユーザー管理
- ✅ 商品管理
- ✅ システム設定
- ✅ プロンプト管理
- ✅ ログ確認

