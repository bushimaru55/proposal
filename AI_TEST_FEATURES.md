# 🤖 AI機能テスト ガイド

管理画面から直接OpenAI APIの動作確認ができるようになりました！

## 📍 機能の場所

### 1. システム設定画面

```
管理画面 → Core → System settings → システム設定
```

**🔑 API設定セクション**に2つのボタンが追加されています：

#### 🔍 接続テストボタン
- **機能**: OpenAI APIとの接続を即座にテスト
- **確認内容**:
  - APIキーの有効性
  - API接続の成功/失敗
  - 使用モデルと設定値
  - AIからのテスト応答
  - トークン使用量

**使い方:**
1. 「🔍 接続テスト」ボタンをクリック
2. 数秒待つと結果が表示されます

**成功時の表示例:**
```
✅ 接続成功！

APIキー: sk-proj...Uy0A
モデル: gpt-4o
Temperature: 0.7
テスト応答: こんにちは！接続テストです。
トークン使用: 25 (入力: 15, 出力: 10)
```

**失敗時の表示例:**
```
❌ 接続失敗

エラー: AuthenticationError
詳細: APIキーが無効か、OpenAIサービスに問題がある可能性があります。
```

---

#### 💬 AIチャットテストボタン
- **機能**: 新しいウィンドウでAIチャット画面を開く
- **用途**: 実際にAIと会話して動作を確認

**使い方:**
1. 「💬 AIチャットテスト」ボタンをクリック
2. 新しいタブで専用のチャット画面が開きます

---

## 🗨️ AIチャットテスト画面

### アクセス方法

**方法1: システム設定から**
```
Core → System settings → 💬 AIチャットテスト ボタン
```

**方法2: 直接URL**
```
http://localhost:8000/admin/ai-chat/
```

### 画面構成

#### ヘッダー部分
- **タイトル**: 🤖 AI チャットテスト
- **説明**: OpenAI APIとの接続を確認し、AIとチャットできます

#### ステータス表示
現在の設定状態を一目で確認できます：

```
APIキー: ✓ 設定済み / ✗ 未設定
AI機能: ✓ 有効 / ✗ 無効
モデル: gpt-4o
Temperature: 0.7
🔍 接続テスト ボタン
```

#### チャットエリア
- **表示サイズ**: 500px（スクロール可能）
- **ユーザーメッセージ**: 右側（青色）
- **AIメッセージ**: 左側（白色）
- **アニメーション**: メッセージ送信時にスムーズに表示

#### 入力エリア
- **メッセージ入力欄**: チャット内容を入力
- **送信ボタン**: メッセージを送信
- **クリアボタン**: 会話履歴をクリア
- **使用状況表示**: トークン数とモデル情報

---

## 💡 使用例

### 基本的な会話テスト

**入力例:**
```
こんにちは！AIの調子はどうですか？
```

**AIの応答:**
```
こんにちは！私は元気に動作しています。
何かお手伝いできることがありますか？
```

### 機能テスト

**データ分析のテスト:**
```
以下のデータから傾向を分析してください：
売上：1月 100万円、2月 120万円、3月 150万円
```

**トークスクリプト生成のテスト:**
```
IT企業向けのクラウドサービスの営業オープニングを作成してください。
```

**商品説明のテスト:**
```
AIを活用した営業支援システムの特徴を3つ挙げてください。
```

---

## 📊 チャット機能の詳細

### 会話履歴管理
- **履歴保持**: 最新10件の会話を記憶
- **コンテキスト**: 過去の会話を考慮した応答
- **クリア機能**: ボタン一つで履歴をリセット

### リアルタイム表示
- **ローディング**: AI応答生成中はスピナー表示
- **即時表示**: 応答が完了すると即座に表示
- **自動スクロール**: 新しいメッセージが自動的に見える位置に

### トークン使用量表示
メッセージ送信後、画面下部に表示されます：

```
トークン使用: 156 (入力: 120, 出力: 36) | モデル: gpt-4o
```

**内訳:**
- **入力トークン**: ユーザーメッセージ + システムプロンプト + 会話履歴
- **出力トークン**: AIの応答
- **合計トークン**: コスト計算に使用

---

## 🔧 トラブルシューティング

### APIキーが設定されていない

**症状:**
- 入力欄が無効化されている
- 送信ボタンがグレーアウト

**対処法:**
1. `Core → System settings` を開く
2. `OpenAI APIキー` を入力
3. `AI機能を有効化` にチェック
4. 保存
5. ページをリロード

### 接続テストが失敗する

**よくある原因:**

#### 1. APIキーが無効
```
エラー: AuthenticationError
→ APIキーを確認して再入力
```

#### 2. ネットワーク問題
```
エラー: Connection timeout
→ インターネット接続を確認
```

#### 3. OpenAI側の問題
```
エラー: RateLimitError または ServiceUnavailableError
→ 数分待ってから再試行
```

### メッセージが送信できない

**確認事項:**
1. APIキー状態が「✓ 設定済み」になっているか
2. AI機能が「✓ 有効」になっているか
3. 入力欄にテキストが入力されているか
4. ブラウザのコンソールにエラーが出ていないか

---

## 🎯 活用シーン

### 開発・テスト時
- API設定後の動作確認
- プロンプトの検証
- モデルやTemperature設定の調整
- レスポンス品質の確認

### デモ・プレゼン時
- クライアントへのAI機能のデモ
- システムの動作説明
- 実際の使用イメージの共有

### トレーニング時
- 新メンバーへのAI機能説明
- プロンプトエンジニアリング学習
- ベストプラクティスの共有

---

## 📈 設定のヒント

### モデルの選択

**GPT-4o（高品質）**
- より正確で詳細な応答
- 複雑な分析や長文生成に最適
- コスト: 高め

**GPT-4o Mini（コスト重視）**
- 十分な品質で高速
- 日常的な会話やシンプルなタスク向け
- コスト: 低め

### Temperature設定

**0.0 - 0.3 (決定論的)**
- 一貫性のある応答
- データ分析、要約に最適
- 創造性: 低

**0.7 (バランス・デフォルト)**
- 適度な創造性と一貫性
- 汎用的な用途に最適
- 推奨設定

**1.5 - 2.0 (創造的)**
- 多様な応答
- ブレインストーミング、アイデア出しに最適
- 創造性: 高

---

## 🔐 セキュリティとコスト管理

### APIキーの管理
- ✅ 管理画面で安全に保管
- ✅ パスワードフィールドで表示（●●●●）
- ✅ 管理者のみアクセス可能
- ⚠️ Git にコミットしない

### コスト管理
- **1日のトークン上限**: システム設定で設定可能
- **使用量の可視化**: チャット画面で確認
- **モデル選択**: 用途に応じて適切なモデルを選択

### 推奨事項
- テスト時は `gpt-4o-mini` を使用
- 本番環境では1日の上限を設定
- 定期的に使用量を確認

---

## 🚀 次のステップ

接続テストとチャットテストが成功したら：

1. **実際のデータでテスト**
   - CSV分析機能を試す
   - 企業情報のスクレイピングを実行

2. **トークスクリプト生成**
   - 商品を登録
   - 企業情報を入力
   - AIスクリプトを生成

3. **PowerPoint生成**
   - 生成したスクリプトから資料を作成
   - ダウンロードして確認

---

## 💬 サポート

問題が解決しない場合：

1. **ログの確認**
   ```bash
   docker-compose logs -f web
   ```

2. **コンテナの再起動**
   ```bash
   docker-compose restart web
   ```

3. **キャッシュのクリア**
   - システム設定を再保存
   - ブラウザのキャッシュをクリア

---

**AI機能を存分にお試しください！** 🎉

