# OpenAI APIキーの設定方法

## 🔑 管理画面から設定（推奨）

### 1. 管理画面にログイン

```
http://localhost:8000/admin/
```

**ログイン情報:**
- ユーザー名: `admin`
- パスワード: `admin123`

### 2. システム設定を開く

1. 左メニューから **Core** セクションを探す
2. **System settings** をクリック
3. 唯一の設定レコードをクリック

### 3. APIキーを入力

**🔑 API設定** セクションで：

1. **OpenAI APIキー** フィールドに実際のAPIキーを入力
   ```
   sk-proj-xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   ```

2. **AI機能を有効化** のチェックボックスを確認（デフォルトでON）

3. **APIキー状態** で現在の設定状態を確認できます：
   - ✓ DBに設定済み (sk-proj...xxxx) → 正常に設定されています
   - ⚠ 環境変数を使用 → 環境変数から読み込んでいます
   - ✗ 未設定 → APIキーが設定されていません

### 4. 保存

画面下の **保存** ボタンをクリックします。

**成功メッセージ:**
```
✓ OpenAI APIキーが正常に保存されました。
```

---

## 🎯 動作確認

APIキー設定後、以下の機能が利用可能になります：

### ✅ 利用可能な機能
- 企業情報のAI分析
- CSV データのAI分析
- トークスクリプトの自動生成
- 商品情報の抽出と構造化
- PowerPoint資料の生成

---

## 🔐 セキュリティ

### APIキーの保管

- ✅ **データベースに保存**（推奨）
  - 管理画面から簡単に変更可能
  - パスワードフィールドで表示（●●●●●）
  - マスクされて表示（先頭と末尾のみ）

- ✅ **環境変数** (`.env`ファイル)
  - バックアップとして機能
  - DBに設定がない場合に自動的に使用

### 優先順位

```
1. データベース（SystemSettings）
2. 環境変数（.env ファイル）
```

---

## 📊 AI設定のカスタマイズ

管理画面の **AI設定** セクションで以下もカスタマイズ可能：

### デフォルトAIモデル
- **GPT-4o（高品質）** - より正確な分析と生成
- **GPT-4o Mini（コスト重視）** - コストを抑えたい場合

### AIのTemperature
- `0.0` - 決定論的、一貫した出力
- `0.7` - デフォルト、バランスの取れた出力
- `2.0` - 創造的、多様な出力

### 1リクエストあたりの最大トークン数
- デフォルト: `4000`
- 範囲: `100` - `16000`

### 1日のトークン上限
- デフォルト: `1,000,000`
- コスト管理に使用

---

## 🔧 トラブルシューティング

### APIキーが認識されない

1. **キャッシュのクリア**
   ```bash
   docker-compose restart web
   ```

2. **APIキーの形式を確認**
   - OpenAI APIキーは `sk-` または `sk-proj-` で始まる
   - 長さは約50文字以上

3. **ログを確認**
   ```bash
   docker-compose logs -f web
   ```

### APIキーをテストする

管理画面のシステム設定を開いて、**APIキー状態** フィールドを確認：
- 緑色 (✓) = 正常
- オレンジ (⚠) = 環境変数使用
- 赤色 (✗) = 未設定

---

## 💡 OpenAI APIキーの取得方法

### 新規取得

1. [OpenAI Platform](https://platform.openai.com/) にアクセス
2. アカウント作成またはログイン
3. 右上のアカウントメニュー → **API keys** をクリック
4. **Create new secret key** をクリック
5. キー名を入力して作成
6. **表示されたキーをコピー**（この後は再表示できません！）

### 既存キーの確認

⚠️ OpenAIでは、一度作成したAPIキーは再表示できません。
- 紛失した場合は新しいキーを作成してください
- 古いキーは削除することをお勧めします

---

## 🚀 次のステップ

APIキー設定完了後：

1. **商品情報を登録**
   - Products → Products → Add

2. **企業情報を登録**
   - Companies → Companies → Add

3. **CSV分析を試す**（オプション）
   - Analysis → CSV uploads → Add

4. **トークスクリプトを生成**
   - Sales → Talk scripts

5. **PowerPointをエクスポート**
   - Exports → Export histories

---

## 📝 注意事項

- 本番環境では必ず管理者パスワードを変更してください
- APIキーは機密情報です。Git にコミットしないでください
- OpenAI APIの利用料金が発生します。使用量を定期的に確認してください
- 1日のトークン上限を設定してコストを管理できます

---

**管理画面でAPIキーを設定すれば、すぐにAI機能が使えます！** 🎉

